
> omnifocus-mcp-cached@3.0.0 test:integration
> vitest tests/integration --run


 RUN  v3.2.4 /Users/kip/src/omnifocus-mcp

 â†“ tests/integration/llm-assistant-simulation.test.ts (14 tests | 14 skipped)
 â†“ tests/integration/batch-operations.test.ts (8 tests | 8 skipped)
stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
ğŸš€ Starting shared MCP server for integration tests...

 â†“ tests/integration/real-llm-integration.test.ts (8 tests | 8 skipped)
 âœ“ tests/integration/edge-case-escaping.test.ts (11 tests) 3ms
stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes review gaps pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes next actions pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes wip limits pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes due date bunching pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes all GTD patterns together
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > includes GTD patterns when "all" is specified
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

 âœ“ tests/integration/analytics/pattern-analysis-tool.test.ts (6 tests) 4ms
 âœ“ tests/integration/tools/unified/OmniFocusWriteTool.test.ts (2 tests) 4ms
[2025-11-20T23:07:38.643Z] [INFO] [ParseMeetingNotesTool] Parsing meeting notes
 âœ“ tests/integration/tools/unified/OmniFocusAnalyzeTool.test.ts (3 tests) 7ms
 âœ“ tests/integration/tools/unified/OmniFocusReadTool.test.ts (3 tests) 5ms
stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
âœ… Shared MCP server ready

stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
ğŸ§¹ Thorough cleanup for session: mcp-test-session-1763680058405-cjhh6f
  ğŸ“Š Thorough cleanup completed in 0ms (0 operations)

 â¯ tests/integration/mcp-protocol.test.ts (7 tests | 1 failed) 16986ms
   âœ“ MCP Protocol Compliance Tests > Server Initialization > should respond to initialize request 1ms
   Ã— MCP Protocol Compliance Tests > Tools Discovery > should list all available tools 6ms
     â†’ expected [ 'omnifocus_read', â€¦(4) ] to deeply equal [ 'omnifocus_read', â€¦(3) ]
   âœ“ MCP Protocol Compliance Tests > Task Operations > should handle tasks tool call  1764ms
   âœ“ MCP Protocol Compliance Tests > Task Operations > should handle task creation with validation  12279ms
   âœ“ MCP Protocol Compliance Tests > Project Operations > should handle projects tool call  2196ms
   âœ“ MCP Protocol Compliance Tests > Error Handling > should handle invalid tool name 1ms
   âœ“ MCP Protocol Compliance Tests > Error Handling > should handle missing required parameters 1ms
 âœ“ tests/integration/validation/filter-results.test.ts (7 tests) 23159ms
   âœ“ Filter Results Validation > Text Filter (Bug #9 Prevention) > should return ONLY tasks containing search text in name or note  5083ms
   âœ“ Filter Results Validation > Date Range Filter (Bug #10 Prevention) > should return ONLY tasks within specified date range  5162ms
   âœ“ Filter Results Validation > Date Range Filter (Bug #10 Prevention) > should exclude tasks before start date  2386ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should return tasks with ANY of specified tags  1338ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should return tasks with ALL specified tags  1246ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should exclude tasks with specified tags (none operator)  4714ms
   âœ“ Filter Results Validation > Combined Filters (P0-3: Complex Queries) > should apply text + date filters together  2463ms
stdout | tests/integration/validation/update-operations.test.ts > Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update plannedDate and persist change (if database migrated)
âš ï¸  plannedDate not available - database may not be migrated for planned dates feature

 âœ“ tests/integration/validation/update-operations.test.ts (12 tests) 66483ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update dueDate and persist change  21365ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update deferDate and persist change  3711ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update plannedDate and persist change (if database migrated)  2359ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should clear dueDate using clearDueDate flag  2892ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support tags (full replacement)  4602ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support addTags (append to existing)  3171ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support removeTags (filter out specified)  3210ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should handle addTags with deduplication  3101ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update note and persist change  2923ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update flagged status and persist change  2843ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update estimatedMinutes and persist change  2881ms
   âœ“ Update Operations - Read-Back Validation > Multiple Updates (Combined Changes) > should apply multiple field updates in single call  3614ms
 â¯ tests/integration/tools/unified/end-to-end.test.ts (19 tests | 1 failed) 96319ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should query inbox tasks  492ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should query tasks with filters  8426ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should list all projects  2516ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should list all tags  1392ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should return count-only for active tasks (33x faster optimization)  1334ms
   Ã— Unified Tools End-to-End Integration > omnifocus_read > should return count-only for flagged tasks 60005ms
     â†’ Request timeout after 60s
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should create a new task  468ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should update the created task 173ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should complete the task  7882ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should delete the completed task  7871ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_analyze > should analyze productivity stats  1625ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_analyze > should parse meeting notes 3ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should create task with planned date  705ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should update task with new planned date  571ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should clear planned date when set to null  495ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with daily repeat rule  662ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with weekly repeat rule  483ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with repeat rule and end date  496ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Version Detection > should report version information in system tool 114ms

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 2 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests > Tools Discovery > should list all available tools
AssertionError: expected [ 'omnifocus_read', â€¦(4) ] to deeply equal [ 'omnifocus_read', â€¦(3) ]

[32m- Expected[39m
[31m+ Received[39m

[2m  [[22m
[2m    "omnifocus_read",[22m
[2m    "omnifocus_write",[22m
[2m    "omnifocus_analyze",[22m
[2m    "system",[22m
[31m+   "manage_task",[39m
[2m  ][22m

 â¯ tests/integration/mcp-protocol.test.ts:65:25
     63| 
     64|       // Ensure ONLY these 4 tools exist
     65|       expect(toolNames).toEqual(['omnifocus_read', 'omnifocus_write', â€¦
       |                         ^
     66|     });
     67|   });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/2]â¯

 FAIL  tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_read > should return count-only for flagged tasks
Error: Request timeout after 60s
 â¯ Timeout._onTimeout tests/integration/tools/unified/end-to-end.test.ts:17:16
     15| 
     16|       const timeout = setTimeout(() => {
     17|         reject(new Error('Request timeout after 60s'));
       |                ^
     18|       }, 60000);
     19| 

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/2]â¯


 Test Files  2 failed | 7 passed | 3 skipped (12)
      Tests  2 failed | 68 passed | 30 skipped (100)
   Start at  18:07:38
   Duration  96.66s (transform 687ms, setup 435ms, collect 1.32s, tests 202.97s, environment 1ms, prepare 473ms)

