
> omnifocus-mcp-cached@3.0.0 test:integration
> vitest tests/integration --run


 RUN  v3.2.4 /Users/kip/src/omnifocus-mcp

 â†“ tests/integration/llm-assistant-simulation.test.ts (14 tests | 14 skipped)
 â†“ tests/integration/real-llm-integration.test.ts (8 tests | 8 skipped)
 â†“ tests/integration/batch-operations.test.ts (8 tests | 8 skipped)
stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
ğŸš€ Starting shared MCP server for integration tests...

 âœ“ tests/integration/edge-case-escaping.test.ts (11 tests) 3ms
stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes review gaps pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes next actions pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes wip limits pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes due date bunching pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes all GTD patterns together
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > includes GTD patterns when "all" is specified
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

 âœ“ tests/integration/analytics/pattern-analysis-tool.test.ts (6 tests) 4ms
 âœ“ tests/integration/tools/unified/OmniFocusWriteTool.test.ts (2 tests) 3ms
[2025-11-20T23:03:05.377Z] [INFO] [ParseMeetingNotesTool] Parsing meeting notes
 âœ“ tests/integration/tools/unified/OmniFocusAnalyzeTool.test.ts (3 tests) 7ms
 âœ“ tests/integration/tools/unified/OmniFocusReadTool.test.ts (3 tests) 5ms
stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
âœ… Shared MCP server ready

 âœ“ tests/integration/validation/filter-results.test.ts (7 tests) 32489ms
   âœ“ Filter Results Validation > Text Filter (Bug #9 Prevention) > should return ONLY tasks containing search text in name or note  8147ms
   âœ“ Filter Results Validation > Date Range Filter (Bug #10 Prevention) > should return ONLY tasks within specified date range  4749ms
   âœ“ Filter Results Validation > Date Range Filter (Bug #10 Prevention) > should exclude tasks before start date  2288ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should return tasks with ANY of specified tags  1999ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should return tasks with ALL specified tags  6002ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should exclude tasks with specified tags (none operator)  7245ms
   âœ“ Filter Results Validation > Combined Filters (P0-3: Complex Queries) > should apply text + date filters together  1375ms
stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
ğŸ§¹ Thorough cleanup for session: mcp-test-session-1763679785132-hlhl8j
  ğŸ“Š Thorough cleanup completed in 0ms (0 operations)

 âœ“ tests/integration/mcp-protocol.test.ts (7 tests) 33614ms
   âœ“ MCP Protocol Compliance Tests > Task Operations > should handle tasks tool call  4047ms
   âœ“ MCP Protocol Compliance Tests > Task Operations > should handle task creation with validation  26795ms
   âœ“ MCP Protocol Compliance Tests > Project Operations > should handle projects tool call  2162ms
stdout | tests/integration/validation/update-operations.test.ts > Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update plannedDate and persist change (if database migrated)
âš ï¸  plannedDate not available - database may not be migrated for planned dates feature

 â¯ tests/integration/tools/unified/end-to-end.test.ts (19 tests | 2 failed) 102544ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should query inbox tasks  4338ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should query tasks with filters  5182ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should list all projects  4133ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should list all tags  2241ms
   Ã— Unified Tools End-to-End Integration > omnifocus_read > should return count-only for active tasks (33x faster optimization) 3521ms
     â†’ expected { operation: 'tasks', â€¦(8) } to have property "count_only" with value true
   Ã— Unified Tools End-to-End Integration > omnifocus_read > should return count-only for flagged tasks 7495ms
     â†’ expected undefined to be true // Object.is equality
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should create a new task  7500ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should update the created task  468ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should complete the task  43049ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should delete the completed task  19091ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_analyze > should analyze productivity stats  1563ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_analyze > should parse meeting notes 3ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should create task with planned date  739ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should update task with new planned date  550ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should clear planned date when set to null  496ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with daily repeat rule  478ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with weekly repeat rule  487ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with repeat rule and end date  487ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Version Detection > should report version information in system tool 113ms
stderr | tests/integration/validation/update-operations.test.ts > Update Operations - Read-Back Validation
Failed to cleanup tasks: Error: Tool error: MCP error -32601: Tool not found: manage_task
    at MCPTestClient.callTool [90m(/Users/kip/src/omnifocus-mcp/[39mtests/integration/helpers/mcp-test-client.ts:187:26[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90m/Users/kip/src/omnifocus-mcp/[39mtests/integration/validation/update-operations.test.ts:26:9 {
  code: [33m-32601[39m,
  data: [90mundefined[39m,
  mcpError: {
    code: [33m-32601[39m,
    message: [32m'MCP error -32601: Tool not found: manage_task'[39m
  }
}

 â¯ tests/integration/validation/update-operations.test.ts (12 tests | 2 failed) 108363ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update dueDate and persist change  34333ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update deferDate and persist change  3620ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update plannedDate and persist change (if database migrated)  2322ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should clear dueDate using clearDueDate flag  2864ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support tags (full replacement)  3063ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support addTags (append to existing)  3115ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support removeTags (filter out specified)  3223ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should handle addTags with deduplication  3028ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update note and persist change  2883ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update flagged status and persist change  2839ms
   Ã— Update Operations - Read-Back Validation > Basic Property Updates > should update estimatedMinutes and persist change 24537ms
     â†’ expected false to be true // Object.is equality
   Ã— Update Operations - Read-Back Validation > Multiple Updates (Combined Changes) > should apply multiple field updates in single call 21864ms
     â†’ expected false to be true // Object.is equality

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 4 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/validation/update-operations.test.ts > Update Operations - Read-Back Validation > Basic Property Updates > should update estimatedMinutes and persist change
AssertionError: expected false to be true // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

 â¯ tests/integration/validation/update-operations.test.ts:265:36
    263| 
    264|       const updateResult = await updateTask(taskId, { estimatedMinutesâ€¦
    265|       expect(updateResult.success).toBe(true);
       |                                    ^
    266| 
    267|       // âœ… Verify estimatedMinutes persisted

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/4]â¯

 FAIL  tests/integration/validation/update-operations.test.ts > Update Operations - Read-Back Validation > Multiple Updates (Combined Changes) > should apply multiple field updates in single call
AssertionError: expected false to be true // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

 â¯ tests/integration/validation/update-operations.test.ts:284:36
    282|         addTags: ['urgent', 'priority']
    283|       });
    284|       expect(updateResult.success).toBe(true);
       |                                    ^
    285| 
    286|       // âœ… Verify ALL changes persisted

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/4]â¯

 FAIL  tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_read > should return count-only for active tasks (33x faster optimization)
AssertionError: expected { operation: 'tasks', â€¦(8) } to have property "count_only" with value true

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

 â¯ tests/integration/tools/unified/end-to-end.test.ts:229:31
    227|       // Verify metadata includes count and optimization flag
    228|       expect(parsed.metadata).toHaveProperty('total_count');
    229|       expect(parsed.metadata).toHaveProperty('count_only', true);
       |                               ^
    230|       expect(parsed.metadata).toHaveProperty('optimization', 'count_onâ€¦
    231|       expect(typeof parsed.metadata.total_count).toBe('number');

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/4]â¯

 FAIL  tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_read > should return count-only for flagged tasks
AssertionError: expected undefined to be true // Object.is equality

[32m- Expected:[39m 
true

[31m+ Received:[39m 
undefined

 â¯ tests/integration/tools/unified/end-to-end.test.ts:270:42
    268|       // Verify count metadata
    269|       expect(parsed.metadata).toHaveProperty('total_count');
    270|       expect(parsed.metadata.count_only).toBe(true);
       |                                          ^
    271|       expect(typeof parsed.metadata.total_count).toBe('number');
    272|     }, 60000);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/4]â¯


 Test Files  2 failed | 7 passed | 3 skipped (12)
      Tests  4 failed | 66 passed | 30 skipped (100)
   Start at  18:03:04
   Duration  108.71s (transform 677ms, setup 497ms, collect 1.35s, tests 277.03s, environment 1ms, prepare 455ms)

