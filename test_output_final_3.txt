
> omnifocus-mcp-cached@3.0.0 test:integration
> vitest tests/integration --run


 RUN  v3.2.4 /Users/kip/src/omnifocus-mcp

 â†“ tests/integration/real-llm-integration.test.ts (8 tests | 8 skipped)
 â†“ tests/integration/batch-operations.test.ts (8 tests | 8 skipped)
stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
ğŸš€ Starting shared MCP server for integration tests...

 â†“ tests/integration/llm-assistant-simulation.test.ts (14 tests | 14 skipped)
 âœ“ tests/integration/edge-case-escaping.test.ts (11 tests) 4ms
stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes review gaps pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes next actions pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes wip limits pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes due date bunching pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes all GTD patterns together
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > includes GTD patterns when "all" is specified
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

 âœ“ tests/integration/analytics/pattern-analysis-tool.test.ts (6 tests) 4ms
 âœ“ tests/integration/tools/unified/OmniFocusWriteTool.test.ts (2 tests) 4ms
[2025-11-20T23:43:04.489Z] [INFO] [ParseMeetingNotesTool] Parsing meeting notes
 âœ“ tests/integration/tools/unified/OmniFocusAnalyzeTool.test.ts (3 tests) 7ms
 âœ“ tests/integration/tools/unified/OmniFocusReadTool.test.ts (3 tests) 5ms
stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
âœ… Shared MCP server ready

stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
ğŸ§¹ Thorough cleanup for session: mcp-test-session-1763682184254-6bct2n
  ğŸ“Š Thorough cleanup completed in 0ms (0 operations)

 âœ“ tests/integration/mcp-protocol.test.ts (7 tests) 13347ms
   âœ“ MCP Protocol Compliance Tests > Task Operations > should handle tasks tool call  2860ms
   âœ“ MCP Protocol Compliance Tests > Task Operations > should handle task creation with validation  8127ms
   âœ“ MCP Protocol Compliance Tests > Project Operations > should handle projects tool call  1590ms
 âœ“ tests/integration/validation/filter-results.test.ts (7 tests) 14573ms
   âœ“ Filter Results Validation > Text Filter (Bug #9 Prevention) > should return ONLY tasks containing search text in name or note  1879ms
   âœ“ Filter Results Validation > Date Range Filter (Bug #10 Prevention) > should return ONLY tasks within specified date range  4696ms
   âœ“ Filter Results Validation > Date Range Filter (Bug #10 Prevention) > should exclude tasks before start date  1736ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should return tasks with ANY of specified tags  1336ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should return tasks with ALL specified tags  1297ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should exclude tasks with specified tags (none operator)  1359ms
   âœ“ Filter Results Validation > Combined Filters (P0-3: Complex Queries) > should apply text + date filters together  1525ms
stdout | tests/integration/validation/update-operations.test.ts > Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update plannedDate and persist change (if database migrated)
âš ï¸  plannedDate not available - database may not be migrated for planned dates feature

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should calculate correct completion rates with known data
ğŸ§¹ Quick cleanup: deleting 5 tasks, 0 projects

stderr | tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_write > should update the created task
Skipping update test - no task ID from create

stderr | tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_write > should complete the task
Skipping complete test - no task ID

stderr | tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_write > should delete the completed task
Skipping delete test - no task ID

 â¯ tests/integration/tools/unified/end-to-end.test.ts (19 tests | 2 failed) 137636ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should query inbox tasks  404ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should query tasks with filters  3619ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should list all projects  3388ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should list all tags  1256ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should return count-only for active tasks (33x faster optimization)  1306ms
   Ã— Unified Tools End-to-End Integration > omnifocus_read > should return count-only for flagged tasks 120008ms
     â†’ Test timed out in 120000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
   Ã— Unified Tools End-to-End Integration > omnifocus_write > should create a new task 2ms
     â†’ expected false to be true // Object.is equality
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should update the created task 0ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should complete the task 0ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should delete the completed task 0ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_analyze > should analyze productivity stats  4374ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_analyze > should parse meeting notes 4ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should create task with planned date  715ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should update task with new planned date 80ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should clear planned date when set to null  755ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with daily repeat rule 28ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with weekly repeat rule  970ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with repeat rule and end date 13ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Version Detection > should report version information in system tool 105ms
stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should return non-zero stats when tasks exist
ğŸ§¹ Quick cleanup: deleting 6 tasks, 0 projects

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should correctly identify overdue tasks
ğŸ§¹ Quick cleanup: deleting 7 tasks, 0 projects

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should correctly identify overdue tasks
  ğŸ“Š Quick cleanup completed in 48003ms (5 operations)

 â¯ tests/integration/validation/update-operations.test.ts (12 tests) 337177ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update dueDate and persist change  14984ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update deferDate and persist change  2257ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update plannedDate and persist change (if database migrated)  1728ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should clear dueDate using clearDueDate flag  2013ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support tags (full replacement)  1941ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support addTags (append to existing)  1927ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support removeTags (filter out specified)  1944ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should handle addTags with deduplication  1929ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update note and persist change  1832ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update flagged status and persist change  1830ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update estimatedMinutes and persist change  1887ms
   âœ“ Update Operations - Read-Back Validation > Multiple Updates (Combined Changes) > should apply multiple field updates in single call  2106ms
stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should handle zero overdue tasks gracefully
ğŸ§¹ Quick cleanup: deleting 1 tasks, 0 projects

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should handle zero overdue tasks gracefully
  ğŸ“Š Quick cleanup completed in 31575ms (3 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > TaskVelocity Calculation Validation > should calculate velocity from completed tasks
  ğŸ“Š Quick cleanup completed in 41585ms (5 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > TaskVelocity Calculation Validation > should calculate velocity from completed tasks
ğŸ§¹ Quick cleanup: deleting 0 tasks, 0 projects
  ğŸ“Š Quick cleanup completed in 0ms (0 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > Cross-Tool Data Consistency > should have consistent task counts across analytics tools
ğŸ§¹ Quick cleanup: deleting 2 tasks, 0 projects

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > Cross-Tool Data Consistency > should have consistent task counts across analytics tools
  ğŸ“Š Quick cleanup completed in 62615ms (4 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations
ğŸ§¹ Thorough cleanup for session: mcp-test-session-1763682184255-um70t1
  ğŸ“Š Thorough cleanup completed in 0ms (0 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations
  ğŸ“Š Quick cleanup completed in 3422ms (1 operations)

 â¯ tests/integration/validation/analytics-validation.test.ts (6 tests | 3 failed) 516223ms
   Ã— Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should calculate correct completion rates with known data 180012ms
     â†’ Test timed out in 90000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
     â†’ Hook timed out in 90000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
   Ã— Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should return non-zero stats when tasks exist 94862ms
     â†’ Hook timed out in 90000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
   Ã— Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should correctly identify overdue tasks 94473ms
     â†’ Hook timed out in 90000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
   âœ“ Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should handle zero overdue tasks gracefully  34780ms
   âœ“ Analytics Validation - Actual Calculations > TaskVelocity Calculation Validation > should calculate velocity from completed tasks  35919ms
   âœ“ Analytics Validation - Actual Calculations > Cross-Tool Data Consistency > should have consistent task counts across analytics tools  72086ms

â¯â¯â¯â¯â¯â¯ Failed Suites 1 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/validation/update-operations.test.ts > Update Operations - Read-Back Validation
Error: Hook timed out in 300000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 â¯ tests/integration/validation/update-operations.test.ts:22:3
     20|   }, 30000);
     21| 
     22|   afterAll(async () => {
       |   ^
     23|     // Cleanup: Delete all created tasks
     24|     if (createdTaskIds.length > 0) {

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/7]â¯


â¯â¯â¯â¯â¯â¯â¯ Failed Tests 5 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should calculate correct completion rates with known data
Error: Test timed out in 90000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 â¯ tests/integration/validation/analytics-validation.test.ts:37:5
     35| 
     36|   describe('ProductivityStats Calculation Validation', () => {
     37|     it('should calculate correct completion rates with known data', asâ€¦
       |     ^
     38|       // Create known test data: 3 completed, 2 pending = 60% completiâ€¦
     39|       await client.createTestTask('Completed 1', { tags: [testSessionTâ€¦

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/7]â¯

 FAIL  tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should calculate correct completion rates with known data
 FAIL  tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should return non-zero stats when tasks exist
 FAIL  tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should correctly identify overdue tasks
Error: Hook timed out in 90000ms.
If this is a long-running hook, pass a timeout value as the last argument or configure it globally with "hookTimeout".
 â¯ tests/integration/validation/analytics-validation.test.ts:27:3
     25|   }, 30000);
     26| 
     27|   afterEach(async () => {
       |   ^
     28|     await client.cleanup();
     29|   }, 90000);

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/7]â¯

 FAIL  tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_read > should return count-only for flagged tasks
Error: Test timed out in 120000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 â¯ tests/integration/tools/unified/end-to-end.test.ts:239:5
    237|     }, 60000);
    238| 
    239|     it('should return count-only for flagged tasks', async () => {
       |     ^
    240|       const result = await sendRequest({
    241|         jsonrpc: '2.0',

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/7]â¯

 FAIL  tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_write > should create a new task
AssertionError: expected false to be true // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

 â¯ tests/integration/tools/unified/end-to-end.test.ts:305:30
    303|       const parsed = JSON.parse(responseText);
    304|       expect(parsed).toHaveProperty('success');
    305|       expect(parsed.success).toBe(true);
       |                              ^
    306| 
    307|       // Extract task ID for subsequent tests

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/7]â¯


 Test Files  3 failed | 7 passed | 3 skipped (13)
      Tests  5 failed | 71 passed | 30 skipped (106)
   Start at  18:43:03
   Duration  516.56s (transform 747ms, setup 535ms, collect 1.45s, tests 1018.98s, environment 1ms, prepare 522ms)

