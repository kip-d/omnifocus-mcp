
> omnifocus-mcp-cached@3.0.0 test:integration
> vitest tests/integration --run


 RUN  v3.2.4 /Users/kip/src/omnifocus-mcp

 â†“ tests/integration/llm-assistant-simulation.test.ts (14 tests | 14 skipped)
 â†“ tests/integration/real-llm-integration.test.ts (8 tests | 8 skipped)
 â†“ tests/integration/batch-operations.test.ts (8 tests | 8 skipped)
stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
ğŸš€ Starting shared MCP server for integration tests...

 âœ“ tests/integration/edge-case-escaping.test.ts (11 tests) 3ms
stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes review gaps pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes next actions pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes wip limits pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes due date bunching pattern
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > analyzes all GTD patterns together
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

stderr | tests/integration/analytics/pattern-analysis-tool.test.ts > PatternAnalysisTool - GTD Patterns Integration > includes GTD patterns when "all" is specified
Skipping test - OmniFocus not available: Failed to fetch complete data from OmniFocus - missing tasks or projects

 âœ“ tests/integration/analytics/pattern-analysis-tool.test.ts (6 tests) 4ms
 âœ“ tests/integration/tools/unified/OmniFocusWriteTool.test.ts (2 tests) 4ms
[2025-11-20T23:39:07.824Z] [INFO] [ParseMeetingNotesTool] Parsing meeting notes
 âœ“ tests/integration/tools/unified/OmniFocusAnalyzeTool.test.ts (3 tests) 7ms
 âœ“ tests/integration/tools/unified/OmniFocusReadTool.test.ts (3 tests) 5ms
stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should calculate correct completion rates with known data
ğŸ§¹ Quick cleanup: deleting 0 tasks, 0 projects
  ğŸ“Š Quick cleanup completed in 0ms (0 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should return non-zero stats when tasks exist
ğŸ§¹ Quick cleanup: deleting 0 tasks, 0 projects
  ğŸ“Š Quick cleanup completed in 0ms (0 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should correctly identify overdue tasks
ğŸ§¹ Quick cleanup: deleting 0 tasks, 0 projects
  ğŸ“Š Quick cleanup completed in 0ms (0 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should handle zero overdue tasks gracefully
ğŸ§¹ Quick cleanup: deleting 0 tasks, 0 projects
  ğŸ“Š Quick cleanup completed in 0ms (0 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > TaskVelocity Calculation Validation > should calculate velocity from completed tasks
ğŸ§¹ Quick cleanup: deleting 0 tasks, 0 projects
  ğŸ“Š Quick cleanup completed in 0ms (0 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > Cross-Tool Data Consistency > should have consistent task counts across analytics tools
ğŸ§¹ Quick cleanup: deleting 0 tasks, 0 projects
  ğŸ“Š Quick cleanup completed in 0ms (0 operations)

stdout | tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations
ğŸ§¹ Thorough cleanup for session: mcp-test-session-1763681947585-uagiub
  ğŸ“Š Thorough cleanup completed in 0ms (0 operations)

 â¯ tests/integration/validation/analytics-validation.test.ts (6 tests | 6 failed) 642ms
   Ã— Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should calculate correct completion rates with known data 6ms
     â†’ Tool error: MCP error -32602: Invalid parameters: mutation: Required
   Ã— Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should return non-zero stats when tasks exist 1ms
     â†’ Tool error: MCP error -32602: Invalid parameters: mutation: Required
   Ã— Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should correctly identify overdue tasks 1ms
     â†’ Tool error: MCP error -32602: Invalid parameters: mutation: Required
   Ã— Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should handle zero overdue tasks gracefully 1ms
     â†’ Tool error: MCP error -32602: Invalid parameters: mutation: Required
   Ã— Analytics Validation - Actual Calculations > TaskVelocity Calculation Validation > should calculate velocity from completed tasks 1ms
     â†’ Tool error: MCP error -32602: Invalid parameters: mutation: Required
   Ã— Analytics Validation - Actual Calculations > Cross-Tool Data Consistency > should have consistent task counts across analytics tools 1ms
     â†’ Tool error: MCP error -32602: Invalid parameters: mutation: Required
stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
âœ… Shared MCP server ready

stdout | tests/integration/mcp-protocol.test.ts > MCP Protocol Compliance Tests
ğŸ§¹ Thorough cleanup for session: mcp-test-session-1763681947587-bb9voq
  ğŸ“Š Thorough cleanup completed in 0ms (0 operations)

 âœ“ tests/integration/mcp-protocol.test.ts (7 tests) 33248ms
   âœ“ MCP Protocol Compliance Tests > Task Operations > should handle tasks tool call  2730ms
   âœ“ MCP Protocol Compliance Tests > Task Operations > should handle task creation with validation  22820ms
   âœ“ MCP Protocol Compliance Tests > Project Operations > should handle projects tool call  6979ms
 âœ“ tests/integration/validation/filter-results.test.ts (7 tests) 42500ms
   âœ“ Filter Results Validation > Text Filter (Bug #9 Prevention) > should return ONLY tasks containing search text in name or note  6682ms
   âœ“ Filter Results Validation > Date Range Filter (Bug #10 Prevention) > should return ONLY tasks within specified date range  5426ms
   âœ“ Filter Results Validation > Date Range Filter (Bug #10 Prevention) > should exclude tasks before start date  4961ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should return tasks with ANY of specified tags  4003ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should return tasks with ALL specified tags  4417ms
   âœ“ Filter Results Validation > Tag Filter Operators (Bug #12 Extension) > should exclude tasks with specified tags (none operator)  5400ms
   âœ“ Filter Results Validation > Combined Filters (P0-3: Complex Queries) > should apply text + date filters together  10840ms
stdout | tests/integration/validation/update-operations.test.ts > Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update plannedDate and persist change (if database migrated)
âš ï¸  plannedDate not available - database may not be migrated for planned dates feature

stderr | tests/integration/validation/update-operations.test.ts > Update Operations - Read-Back Validation
Failed to cleanup tasks: Error: Tool error: MCP error -32601: Tool not found: manage_task
    at MCPTestClient.callTool [90m(/Users/kip/src/omnifocus-mcp/[39mtests/integration/helpers/mcp-test-client.ts:187:26[90m)[39m
[90m    at processTicksAndRejections (node:internal/process/task_queues:103:5)[39m
    at [90m/Users/kip/src/omnifocus-mcp/[39mtests/integration/validation/update-operations.test.ts:26:9 {
  code: [33m-32601[39m,
  data: [90mundefined[39m,
  mcpError: {
    code: [33m-32601[39m,
    message: [32m'MCP error -32601: Tool not found: manage_task'[39m
  }
}

 âœ“ tests/integration/validation/update-operations.test.ts (12 tests) 82116ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update dueDate and persist change  37251ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update deferDate and persist change  9125ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should update plannedDate and persist change (if database migrated)  3145ms
   âœ“ Update Operations - Read-Back Validation > Date Updates (Bug #11 Prevention) > should clear dueDate using clearDueDate flag  3940ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support tags (full replacement)  4939ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support addTags (append to existing)  2635ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should support removeTags (filter out specified)  2606ms
   âœ“ Update Operations - Read-Back Validation > Tag Operations (Bug #12 Prevention) > should handle addTags with deduplication  2597ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update note and persist change  4593ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update flagged status and persist change  3527ms
   âœ“ Update Operations - Read-Back Validation > Basic Property Updates > should update estimatedMinutes and persist change  2993ms
   âœ“ Update Operations - Read-Back Validation > Multiple Updates (Combined Changes) > should apply multiple field updates in single call  4065ms
stderr | tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_write > should update the created task
Skipping update test - no task ID from create

stderr | tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_write > should complete the task
Skipping complete test - no task ID

stderr | tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_write > should delete the completed task
Skipping delete test - no task ID

 â¯ tests/integration/tools/unified/end-to-end.test.ts (19 tests | 3 failed) 147210ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should query inbox tasks  370ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should query tasks with filters  10273ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should list all projects  3700ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should list all tags  3008ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_read > should return count-only for active tasks (33x faster optimization)  3930ms
   Ã— Unified Tools End-to-End Integration > omnifocus_read > should return count-only for flagged tasks 120010ms
     â†’ Test timed out in 120000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
   Ã— Unified Tools End-to-End Integration > omnifocus_write > should create a new task 2ms
     â†’ expected false to be true // Object.is equality
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should update the created task 0ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should complete the task 0ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_write > should delete the completed task 0ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_analyze > should analyze productivity stats  1748ms
   âœ“ Unified Tools End-to-End Integration > omnifocus_analyze > should parse meeting notes 4ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should create task with planned date 136ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should update task with new planned date  1053ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Planned Dates > should clear planned date when set to null 29ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with daily repeat rule  1053ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with weekly repeat rule 47ms
   âœ“ Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Enhanced Repeats > should create task with repeat rule and end date  1102ms
   Ã— Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Version Detection > should report version information in system tool 100ms
     â†’ expected undefined to be defined

â¯â¯â¯â¯â¯â¯â¯ Failed Tests 9 â¯â¯â¯â¯â¯â¯â¯

 FAIL  tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should calculate correct completion rates with known data
Error: Tool error: MCP error -32602: Invalid parameters: mutation: Required
 â¯ MCPTestClient.callTool tests/integration/helpers/mcp-test-client.ts:187:26
    185|     // Critical Issue #4: Preserve error details in thrown errors
    186|     if (response.error) {
    187|       const error: any = new Error(`Tool error: ${response.error.messaâ€¦
       |                          ^
    188|       error.code = response.error.code;
    189|       error.data = response.error.data;
 â¯ MCPTestClient.createTestTask tests/integration/helpers/mcp-test-client.ts:217:20
 â¯ tests/integration/validation/analytics-validation.test.ts:39:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[1/9]â¯

 FAIL  tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > ProductivityStats Calculation Validation > should return non-zero stats when tasks exist
Error: Tool error: MCP error -32602: Invalid parameters: mutation: Required
 â¯ MCPTestClient.callTool tests/integration/helpers/mcp-test-client.ts:187:26
    185|     // Critical Issue #4: Preserve error details in thrown errors
    186|     if (response.error) {
    187|       const error: any = new Error(`Tool error: ${response.error.messaâ€¦
       |                          ^
    188|       error.code = response.error.code;
    189|       error.data = response.error.data;
 â¯ MCPTestClient.createTestTask tests/integration/helpers/mcp-test-client.ts:217:20
 â¯ tests/integration/validation/analytics-validation.test.ts:117:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[2/9]â¯

 FAIL  tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should correctly identify overdue tasks
Error: Tool error: MCP error -32602: Invalid parameters: mutation: Required
 â¯ MCPTestClient.callTool tests/integration/helpers/mcp-test-client.ts:187:26
    185|     // Critical Issue #4: Preserve error details in thrown errors
    186|     if (response.error) {
    187|       const error: any = new Error(`Tool error: ${response.error.messaâ€¦
       |                          ^
    188|       error.code = response.error.code;
    189|       error.data = response.error.data;
 â¯ MCPTestClient.createTestTask tests/integration/helpers/mcp-test-client.ts:217:20
 â¯ tests/integration/validation/analytics-validation.test.ts:141:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[3/9]â¯

 FAIL  tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > OverdueAnalysis Calculation Validation > should handle zero overdue tasks gracefully
Error: Tool error: MCP error -32602: Invalid parameters: mutation: Required
 â¯ MCPTestClient.callTool tests/integration/helpers/mcp-test-client.ts:187:26
    185|     // Critical Issue #4: Preserve error details in thrown errors
    186|     if (response.error) {
    187|       const error: any = new Error(`Tool error: ${response.error.messaâ€¦
       |                          ^
    188|       error.code = response.error.code;
    189|       error.data = response.error.data;
 â¯ MCPTestClient.createTestTask tests/integration/helpers/mcp-test-client.ts:217:20
 â¯ tests/integration/validation/analytics-validation.test.ts:182:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[4/9]â¯

 FAIL  tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > TaskVelocity Calculation Validation > should calculate velocity from completed tasks
Error: Tool error: MCP error -32602: Invalid parameters: mutation: Required
 â¯ MCPTestClient.callTool tests/integration/helpers/mcp-test-client.ts:187:26
    185|     // Critical Issue #4: Preserve error details in thrown errors
    186|     if (response.error) {
    187|       const error: any = new Error(`Tool error: ${response.error.messaâ€¦
       |                          ^
    188|       error.code = response.error.code;
    189|       error.data = response.error.data;
 â¯ MCPTestClient.createTestTask tests/integration/helpers/mcp-test-client.ts:217:20
 â¯ tests/integration/validation/analytics-validation.test.ts:205:22

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[5/9]â¯

 FAIL  tests/integration/validation/analytics-validation.test.ts > Analytics Validation - Actual Calculations > Cross-Tool Data Consistency > should have consistent task counts across analytics tools
Error: Tool error: MCP error -32602: Invalid parameters: mutation: Required
 â¯ MCPTestClient.callTool tests/integration/helpers/mcp-test-client.ts:187:26
    185|     // Critical Issue #4: Preserve error details in thrown errors
    186|     if (response.error) {
    187|       const error: any = new Error(`Tool error: ${response.error.messaâ€¦
       |                          ^
    188|       error.code = response.error.code;
    189|       error.data = response.error.data;
 â¯ MCPTestClient.createTestTask tests/integration/helpers/mcp-test-client.ts:217:20
 â¯ tests/integration/validation/analytics-validation.test.ts:245:7

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[6/9]â¯

 FAIL  tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_read > should return count-only for flagged tasks
Error: Test timed out in 120000ms.
If this is a long-running test, pass a timeout value as the last argument or configure it globally with "testTimeout".
 â¯ tests/integration/tools/unified/end-to-end.test.ts:239:5
    237|     }, 60000);
    238| 
    239|     it('should return count-only for flagged tasks', async () => {
       |     ^
    240|       const result = await sendRequest({
    241|         jsonrpc: '2.0',

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[7/9]â¯

 FAIL  tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > omnifocus_write > should create a new task
AssertionError: expected false to be true // Object.is equality

[32m- Expected[39m
[31m+ Received[39m

[32m- true[39m
[31m+ false[39m

 â¯ tests/integration/tools/unified/end-to-end.test.ts:305:30
    303|       const parsed = JSON.parse(responseText);
    304|       expect(parsed).toHaveProperty('success');
    305|       expect(parsed.success).toBe(true);
       |                              ^
    306| 
    307|       // Extract task ID for subsequent tests

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[8/9]â¯

 FAIL  tests/integration/tools/unified/end-to-end.test.ts > Unified Tools End-to-End Integration > OmniFocus 4.7+ Features > Version Detection > should report version information in system tool
AssertionError: expected undefined to be defined
 â¯ tests/integration/tools/unified/end-to-end.test.ts:719:52
    717|         const parsed = JSON.parse(content[0].text);
    718|         expect(parsed.success).toBe(true);
    719|         expect(parsed.metadata?.omnifocus_version).toBeDefined();
       |                                                    ^
    720|       }, 60000);
    721|     });

â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯â¯[9/9]â¯


 Test Files  2 failed | 8 passed | 3 skipped (13)
      Tests  9 failed | 67 passed | 30 skipped (106)
   Start at  18:39:07
   Duration  147.53s (transform 738ms, setup 539ms, collect 1.39s, tests 305.74s, environment 1ms, prepare 539ms)

